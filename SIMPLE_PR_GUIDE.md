# æœ€ã‚‚ç°¡å˜ãªãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆæ–¹æ³•

## ã‚¹ãƒ†ãƒƒãƒ—1: GitHubã§yomitokuã‚’ãƒ•ã‚©ãƒ¼ã‚¯

1. https://github.com/Utakata/yomitoku ã«ã‚¢ã‚¯ã‚»ã‚¹
2. å³ä¸Šã®ã€ŒForkã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ•ã‚©ãƒ¼ã‚¯ã‚’ä½œæˆ

## ã‚¹ãƒ†ãƒƒãƒ—2: GitHubä¸Šã§ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: GitHub Web Editorã‚’ä½¿ç”¨ï¼ˆæœ€ã‚‚ç°¡å˜ï¼‰

1. ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸãƒªãƒã‚¸ãƒˆãƒªï¼ˆ`https://github.com/YOUR_USERNAME/yomitoku`ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹
2. `src/yomitoku/utils/searchable_pdf.py` ã‚’é–‹ã
3. é‰›ç­†ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆEdit this fileï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯
4. Replitã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸæ”¹å–„ç‰ˆã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒšãƒ¼ã‚¹ãƒˆ
5. ä¸‹éƒ¨ã®ã€ŒCommit changesã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - Commit message: `feat: Add furigana filtering for screen reader accessibility`
   - Description: ï¼ˆä»»æ„ï¼‰
6. ã€ŒCommit changesã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
7. ãƒªãƒã‚¸ãƒˆãƒªã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚Šã€ã€ŒContributeã€â†’ã€ŒOpen pull requestã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: github.devã‚’ä½¿ç”¨ï¼ˆVS Codeé¢¨ã‚¨ãƒ‡ã‚£ã‚¿ï¼‰

1. ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã§ `.` ã‚­ãƒ¼ï¼ˆãƒ‰ãƒƒãƒˆï¼‰ã‚’æŠ¼ã™
   - ã¾ãŸã¯ã€URLã‚’ `github.com` â†’ `github.dev` ã«å¤‰æ›´
2. VS Codeé¢¨ã®ã‚¨ãƒ‡ã‚£ã‚¿ãŒé–‹ã
3. `src/yomitoku/utils/searchable_pdf.py` ã‚’é–‹ã„ã¦ç·¨é›†
4. å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€ŒSource Controlã€ï¼ˆGit ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã‚’é–‹ã
5. å¤‰æ›´ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° â†’ ã‚³ãƒŸãƒƒãƒˆ â†’ ãƒ—ãƒƒã‚·ãƒ¥
6. GitHubã®ãƒªãƒã‚¸ãƒˆãƒªãƒšãƒ¼ã‚¸ã§ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

## ã‚¹ãƒ†ãƒƒãƒ—3: æ”¹å–„ç‰ˆã®ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—

Replitã‹ã‚‰ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ï¼š

### ğŸ“„ searchable_pdf.py ã®æ”¹å–„ç‰ˆ

ä»¥ä¸‹ã®å¤‰æ›´ç®‡æ‰€ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€GitHubã§è©²å½“ç®‡æ‰€ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚

#### 1. importæ–‡ã«è¿½åŠ ï¼ˆ1-2è¡Œç›®ï¼‰
```python
import os
import re  # â† ã“ã®è¡Œã‚’è¿½åŠ 
```

#### 2. é–¢æ•°ã‚’è¿½åŠ ï¼ˆ68è¡Œç›®ä»¥é™ã«è¿½åŠ ï¼‰

to_full_widthé–¢æ•°ã®å¾Œã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```python
def _is_kana_only(text):
    """
    Check if text contains only hiragana, katakana, and Japanese punctuation.
    Returns True if the text is likely furigana.
    """
    # Pattern: hiragana, katakana, small kana, Japanese punctuation, whitespace
    kana_pattern = re.compile(r'^[\u3040-\u309F\u30A0-\u30FF\u3001-\u303F\s]+$')
    return bool(kana_pattern.match(text))


def _is_furigana(text, font_size, bbox_height, bbox_width):
    """
    Determine if a text element is furigana based on multiple criteria:
    1. Font size is small (< 8pt)
    2. Text contains only kana characters
    3. Bounding box is small relative to typical text
    
    Args:
        text: The text content
        font_size: Calculated font size
        bbox_height: Height of bounding box
        bbox_width: Width of bounding box
    
    Returns:
        bool: True if the text is likely furigana
    """
    # Criterion 1: Small font size (typical furigana is < 8pt)
    if font_size >= 8:
        return False
    
    # Criterion 2: Must be kana-only
    if not _is_kana_only(text):
        return False
    
    # Criterion 3: Small bounding box (furigana is typically small)
    # For horizontal text, height < 12px; for vertical, width < 12px
    if bbox_height < 12 or bbox_width < 12:
        return True
    
    return False
```

#### 3. create_searchable_pdfé–¢æ•°å†…ã«è¿½åŠ ï¼ˆ142-149è¡Œç›®ã‚ãŸã‚Šï¼‰

ä»¥ä¸‹ã®éƒ¨åˆ†ã‚’æ¢ã—ã¦ï¼š
```python
            if direction == "horizontal":
                font_size = _calc_font_size(text, bbox_height, bbox_width)
            else:
                font_size = _calc_font_size(text, bbox_width, bbox_height)

            c.setFont("MPLUS1p-Medium", font_size)
```

ã“ã®å¾Œã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
```python
            # Skip furigana from the accessible text layer
            # Furigana will remain visible in the image layer but won't be read by screen readers
            if _is_furigana(text, font_size, bbox_height, bbox_width):
                continue
```

å®Œæˆå½¢ï¼š
```python
            if direction == "horizontal":
                font_size = _calc_font_size(text, bbox_height, bbox_width)
            else:
                font_size = _calc_font_size(text, bbox_width, bbox_height)

            # Skip furigana from the accessible text layer
            # Furigana will remain visible in the image layer but won't be read by screen readers
            if _is_furigana(text, font_size, bbox_height, bbox_width):
                continue

            c.setFont("MPLUS1p-Medium", font_size)
```

## ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

1. GitHubã®ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã«æˆ»ã‚‹
2. ã€ŒContributeã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€ŒOpen pull requestã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ã‚¿ã‚¤ãƒˆãƒ«: `[Feature] Add furigana filtering for screen reader accessibility in searchable PDF`
5. èª¬æ˜æ–‡: `PULL_REQUEST_TEMPLATE.md` ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
6. ã€ŒCreate pull requestã€ã‚’ã‚¯ãƒªãƒƒã‚¯

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q: GitHubã§ç·¨é›†ã§ããªã„
A: ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸãƒªãƒã‚¸ãƒˆãƒªï¼ˆ`YOUR_USERNAME/yomitoku`ï¼‰ã§ç·¨é›†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚å…ƒã®ãƒªãƒã‚¸ãƒˆãƒªï¼ˆ`Utakata/yomitoku`ï¼‰ã¯ç·¨é›†ã§ãã¾ã›ã‚“ã€‚

### Q: ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ä½•ã‚’æ›¸ã‘ã°ã„ã„ï¼Ÿ
A: 
```
feat: Add furigana filtering for screen reader accessibility

- Add _is_kana_only() and _is_furigana() functions
- Skip furigana in accessible text layer
- Support horizontal and vertical Japanese text
```

### Q: å¤‰æ›´ãŒã†ã¾ãé©ç”¨ã•ã‚Œãªã„
A: å®Œå…¨ç‰ˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Replitã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€GitHubã®ã€ŒUpload filesã€æ©Ÿèƒ½ã§ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

---

**ã“ã®ã‚¬ã‚¤ãƒ‰ã§å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•™ãˆã¦ãã ã•ã„ï¼**
